CREATE USER flex IDENTIFIED BY flex;
GRANT CONNECT, resource, dba TO flex;

CREATE tablespace flex
    datafile '/u01/app/oracle/oradata/xe/flex.dbf'
    SIZE 100M
    autoextend ON NEXT 10M;

ALTER USER flex DEFAULT tablespace FLEX quota unlimited ON FLEX
    TEMPORARY tablespace temp;

-- DISTRIBUTEMONEY_DETAIL_SEQ: sequence
CREATE SEQUENCE "FLEX"."DISTRIBUTEMONEY_DETAIL_SEQ" MINVALUE 0 MAXVALUE 9999999999999999 INCREMENT BY 1 START WITH 260 CACHE 20 NOORDER CYCLE NOPARTITION
/

-- T_DISTRIBUTEMONEY_LIST: table
CREATE TABLE "FLEX"."T_DISTRIBUTEMONEY_LIST"
(
    "ROOM_ID"      VARCHAR2(100) NOT NULL ENABLE,
    "TOKEN"        VARCHAR2(3)   NOT NULL ENABLE,
    "USER_ID"      NUMBER        NOT NULL ENABLE,
    "TOTAL_AMOUNT" NUMBER,
    "REG_DATE"     DATE DEFAULT sysdate,
    "EXP_DATE"     DATE DEFAULT sysdate + 1 / 24 / 6,
    "DEL_DATE"     DATE DEFAULT sysdate + 8,
    CONSTRAINT "T_DISTRIBUTEMONEY_LIST_PK" PRIMARY KEY ("ROOM_ID", "TOKEN")
        USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
            STORAGE (INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
            PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
            BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
            TABLESPACE "FLEX" ENABLE
) SEGMENT CREATION IMMEDIATE
    PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
    NOCOMPRESS LOGGING
    STORAGE
(
    INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
    PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
    BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT
)
    TABLESPACE "FLEX"
/

-- T_DISTRIBUTEMONEY_DETAIL: table
CREATE TABLE "FLEX"."T_DISTRIBUTEMONEY_DETAIL"
(
    "SEQ"          NUMBER(*, 0) DEFAULT "FLEX"."DISTRIBUTEMONEY_DETAIL_SEQ"."NEXTVAL" NOT NULL ENABLE,
    "ROOM_ID"      VARCHAR2(100)                                                      NOT NULL ENABLE,
    "TOKEN"        VARCHAR2(3)                                                        NOT NULL ENABLE,
    "AMOUNT"       NUMBER                                                             NOT NULL ENABLE,
    "RECV_USER_ID" NUMBER       DEFAULT NULL,
    CONSTRAINT "T_DISTRIBUTEMONEY_DETAIL_PK" PRIMARY KEY ("SEQ")
        USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
            STORAGE (INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
            PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
            BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
            TABLESPACE "FLEX" ENABLE,
    CONSTRAINT "T_DISTRIBUTEMONEY_DETAIL_FK" FOREIGN KEY ("ROOM_ID", "TOKEN")
        REFERENCES "FLEX"."T_DISTRIBUTEMONEY_LIST" ("ROOM_ID", "TOKEN") ON DELETE CASCADE ENABLE
) SEGMENT CREATION IMMEDIATE
    PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
    NOCOMPRESS LOGGING
    STORAGE
(
    INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
    PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
    BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT
)
    TABLESPACE "FLEX"
/

-- GET_NEXT_SEQ: routine
CREATE OR REPLACE EDITIONABLE FUNCTION "FLEX"."GET_NEXT_SEQ" RETURN NUMBER AS
    num NUMBER;
BEGIN
    SELECT DISTRIBUTEMONEY_DETAIL_SEQ.nextval
    INTO num
    FROM dual;
    return num;
END GET_NEXT_SEQ;
/

